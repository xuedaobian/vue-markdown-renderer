import{_ as e,c as o,o as i,ag as s}from"./chunks/framework.CA53vVaN.js";const k=JSON.parse('{"title":"Monaco 内部实现","description":"","frontmatter":{},"headers":[],"relativePath":"zh/guide/monaco-internals.md","filePath":"zh/guide/monaco-internals.md"}'),t={name:"zh/guide/monaco-internals.md"};function n(l,a,r,d,c,h){return i(),o("div",null,[...a[0]||(a[0]=[s('<h1 id="monaco-内部实现" tabindex="-1">Monaco 内部实现 <a class="header-anchor" href="#monaco-内部实现" aria-label="Permalink to &quot;Monaco 内部实现&quot;">​</a></h1><p>本文档介绍在 <code>vue-markdown-render</code> 中使用 <code>monaco-editor</code> 时的打包和运行时要点（用于在项目中集成大型编辑器时减少问题）。</p><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stream-monaco</span></span></code></pre></div><h2 id="vite-打包建议" tabindex="-1">Vite 打包建议 <a class="header-anchor" href="#vite-打包建议" aria-label="Permalink to &quot;Vite 打包建议&quot;">​</a></h2><ul><li>Monaco 使用 Web Worker 来处理语法高亮与语言服务；在生产环境下需要正确的 worker 配置。</li><li>推荐使用 <code>vite-plugin-monaco-editor-esm</code> 或 <code>vite-plugin-monaco-editor</code> 来确保 worker 文件被正确打包。</li></ul><p>示例：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> monacoEditorPlugin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite-plugin-monaco-editor&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ plugins: [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">monacoEditorPlugin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()] })</span></span></code></pre></div><h2 id="避免-failed-to-load-monaco-worker-错误" tabindex="-1">避免 <code>Failed to load Monaco worker</code> 错误 <a class="header-anchor" href="#避免-failed-to-load-monaco-worker-错误" aria-label="Permalink to &quot;避免 `Failed to load Monaco worker` 错误&quot;">​</a></h2><ul><li>确认插件将 worker 文件打包到可访问的路径（可通过插件提供的 <code>customDistPath</code> 配置来控制）。</li><li>在构建产物中检查 worker 文件是否存在，并确认 CDN 或静态资源路径可访问。</li></ul><p>如果你将 <code>vue-markdown-render</code> 发布为库，请确保使用者把 <code>stream-monaco</code> 作为 peer 依赖安装；否则在运行时找不到 Monaco worker 与 runtime。</p><h2 id="运行时行为与性能" tabindex="-1">运行时行为与性能 <a class="header-anchor" href="#运行时行为与性能" aria-label="Permalink to &quot;运行时行为与性能&quot;">​</a></h2><ul><li>本库设计为当 <code>CodeBlockNode</code> 挂载时懒加载 Monaco，从而减少首次渲染时的包体积。仅在需要时才初始化 Monaco 编辑器。</li><li>在大量 CodeBlock 的页面中，启用 <code>viewportPriority</code> 或在父组件中延迟加载可以显著降低内存占用并提升首屏速度。</li></ul><h2 id="打包到库的注意事项" tabindex="-1">打包到库的注意事项 <a class="header-anchor" href="#打包到库的注意事项" aria-label="Permalink to &quot;打包到库的注意事项&quot;">​</a></h2><ul><li>当把本库打包进其他项目时，请在目标项目中正确配置 worker 路径或使用插件的选项来重新定位。</li><li>考虑使用 <code>preload</code> 或 <code>getUseMonaco()</code> 在页面需要时预加载 Monaco，这样能改善用户首次打开大型文档时的响应。</li></ul><h2 id="常见故障排查" tabindex="-1">常见故障排查 <a class="header-anchor" href="#常见故障排查" aria-label="Permalink to &quot;常见故障排查&quot;">​</a></h2><ul><li>如果看到 <code>Failed to load Monaco worker</code>，先在浏览器网络面板（Network）中检查 worker 文件的请求与响应；资源 404 或路径不正确通常就是问题所在。</li><li>如果在 SSR 场景报错，请确认 Monaco 仅在客户端初始化（使用动态导入或 <code>onMounted</code> 来隔离）。</li></ul>',17)])])}const u=e(t,[["render",n]]);export{k as __pageData,u as default};
